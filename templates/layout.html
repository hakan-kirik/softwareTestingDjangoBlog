{% load static %}
<!DOCTYPE html>
<html lang="en">

<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <meta http-equiv="X-UA-Compatible" content="ie=edge" />
  <meta name="description" content="KIRIKsoft  IT Çözümleri">
  <link href="{% static '/images/favicon/favicon.ico' %}" rel="icon">
  <title>KIRIKsoft IT Çözümleri Ve Blogları</title>

  <link rel="stylesheet"
    href="https://fonts.googleapis.com/css2?family=IBM+Plex+Sans:wght@400;500;600;700&family=Roboto:wght@400;700&display=swap">
  <link rel="stylesheet" href="https://use.fontawesome.com/releases/v5.1.1/css/all.css">
  <link rel="stylesheet" href="{% static 'css/libraries.css' %}">
  <link rel="stylesheet" href="{% static 'css/style.css' %}">
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/4.7.0/css/font-awesome.min.css"  />
</head>

<body>
  <div class="wrapper">
    <div  id="preloader" class="preloader">
      <div class="loading"><span></span><span></span><span></span><span></span></div>
    </div> 
    <!-- /.preloader -->

  
    

    <!-- =========================
        Header
    =========================== -->
    {% include 'partials/_header.html' %}
    <!-- /.Header -->

    <!-- ============================
        Slider
    ============================== -->

{% block pagetitle %}
{% endblock  %}


    <!-- ======================
      Blog Grid
    ========================= -->
 {% block content %}
 
 {% endblock  %}



    <!-- ========================
        Footer
      ========================== -->
    {% include "partials/_footer.html" %}
      <!-- /.Footer -->
    <button id="scrollTopBtn"><i class="fas fa-long-arrow-alt-up"></i></button>
    <div class="login-popup" id="login-popup">
      <div class="login-popup-wrapper">
          <form class="login-popup__form" method="post" action="{% url 'login' %}" >
              {% csrf_token %}
              <h3 class="login-popup__title">Giriş Yap!</h3>
              <p class="login-popup__desc">Bağlanın, düzenleyin ve BT işletmenizi güvende tutmak için gerekenleri yapın.</p>
              <div class="form-group mb-20">
                  <i class="icon-mail input-icon"></i>
                  <input type="text" class="form-control" id="username" name="username" placeholder="Kullanıcı Adı">
              </div>
              <div class="form-group mb-20">
                  <i class="icon-lock input-icon"></i>
                  <input type="password" class="form-control" id="password" placeholder="********" name="password">
              </div>
              <div class="d-flex align-items-center justify-content-between mb-20">
                 
              </div>
              <button type="submit" class="btn btn__primary btn__block btn__xl">
                  <span>Giriş Yap</span>
                  <i class="icon-arrow-right"></i>
              </button>
          </form>
          <div class="d-flex justify-content-center align-items-center mt-20">
              <span class="color-white fz-14 font-weight-bold">Hesabınız Yok mu?</span>
              <button id="go-register" class="go-register fz-14 font-weight-bold">
                  <span>Buradan Kayıt Olun</span><i class="icon-arrow-right"></i>
              </button>
          </div>
      </div>
  </div><!-- /.login-popup -->
  
  <div class="login-popup" id="register-popup">
      <div class="login-popup-wrapper">
          <form class="login-popup__form" id="register-form">
              {% csrf_token %}
              <h3 class="login-popup__title">Kayıt Ol!</h3>
              <p class="login-popup__desc">Bağlanın, düzenleyin ve BT işletmenizi güvende tutmak için gerekenleri yapın.</p>
              <div id="error-message" style="color: red;"></div>
              <div class="form-group mb-20">
                  <i class="icon-user input-icon"></i>
                  <input type="text" class="form-control" id="username1" placeholder="Kullanıcı Adı">
              </div>
              <div class="form-group mb-20">
                  <i class="icon-mail input-icon"></i>
                  <input type="email" class="form-control" id="email" placeholder="Email">
              </div>
              <div class="form-group mb-20">
                  <i class="icon-lock input-icon"></i>
                  <input type="password" class="form-control" id="password1" placeholder="********">
              </div>
              <div class="form-group mb-20">
                  <i class="icon-lock input-icon"></i>
                  <input type="password" class="form-control" id="password2" placeholder="********">
              </div>
              <div class="d-flex align-items-center justify-content-between mb-20">
            
              </div>
              <button type="submit" class="btn btn__primary btn__block btn__xl">
                  <span>Kayıt Ol</span>
                  <i class="icon-arrow-right"></i>
              </button>
  
          </form>
          <div class="d-flex justify-content-center align-items-center mt-20">
              <span class="color-white fz-14 font-weight-bold">Zaten Hesabınız Var mı?</span>
              <button id="go-login" class="go-login fz-14 font-weight-bold">
                  <span>Buradan Giriş Yapın</span><i class="icon-arrow-right"></i>
              </button>
          </div>
      </div>
  </div><!-- /.register-popup -->
  
    


    <div class="search-popup">
      <button type="button" class="search-popup__close"><i class="fas fa-times"></i></button>
      <form class="search-popup__form">
        <input type="text" class="search-popup__form__input" placeholder="Type Words Then Enter">
        <button class="search-popup__btn"><i class="icon-search"></i></button>
      </form>
    </div><!-- /. search-popup -->
  </div><!-- /.wrapper -->

  <script src="{% static 'js/jquery-3.5.1.min.js' %}"></script>
  <script src="{% static 'js/plugins.js' %}"></script>
  <script src="{% static 'js/main.js' %}"></script>
  <script>
    $(window).on('load', function() {
        $('#preloader').fadeOut('slow', function() {
            $(this).remove();
        });
    });
    
</script>
<script>
  document.addEventListener("DOMContentLoaded", function() {
      // Kullanıcı oturum açmışsa ve modal varsa
      var modal = document.getElementById('login-popup');
      var queryParams = window.location.search;      
      if (queryParams?.includes("next=") && modal) {
        $('#custom-toast').toast('show');

     //   modal.classList.add('active'); // Modalı göstermek için 'show' sınıfını ekle
      }
  });
  </script>

  <script>
  
    document.addEventListener('DOMContentLoaded', function() {
      document.querySelector('.login-popup__form').onsubmit = function(event) {
          event.preventDefault(); // Formun normal gönderimini engelle
          
          const username = document.querySelector('#username').value;
          const password = document.querySelector('#password').value;
          const csrfToken = document.querySelector('input[name="csrfmiddlewaretoken"]').value;
  
          fetch("{% url 'ajax_login' %}", {
              method: 'POST',
              headers: {
                  'Content-Type': 'application/x-www-form-urlencoded',
                  'X-CSRFToken': csrfToken
              },
              body: new URLSearchParams({
                  'username': username,
                  'password': password
              })
          })
          .then(response => {
              if (response.ok) {
                  return response.json();
              } else {
                  throw new Error('Login failed');
              }
          })
          .then(data => {
              if (data.status === 'success') {
                const queryString = window.location.search;
                const urlParams = new URLSearchParams(queryString);
                let next= urlParams.get('next');
                if(next)
                  window.location.href = window.location.pathname;
                else
                  window.location.href = '/admin'; // Yönlendirme
              } else {
                  alert('Login failed: ' + data.message);
              }
          })
          .catch(error => {
              console.error('Error during login:', error);
              alert('There was an error while trying to login.');
          });
      };
  });
  </script>
  <script>
    document.getElementById("register-form").addEventListener("submit", function(event) {
      console.log(`bak buradayim`)
        event.preventDefault();
        const email = document.getElementById("email").value;
        const username = document.getElementById('username1').value;
        const password1 = document.getElementById("password1").value;
        const password2 = document.getElementById("password2").value;
        const csrfToken = document.querySelector('input[name="csrfmiddlewaretoken"]').value;

        fetch("{% url 'register' %}", {
            method: 'POST',
            headers: {
                'Content-Type': 'application/x-www-form-urlencoded',
                'X-CSRFToken': csrfToken
            },
            body: new URLSearchParams({
                'username':username,
                'email': email,
                'password1': password1,
                'password2': password2
            })
        })
        .then(response => {
            if (response.ok) {
                window.location.href = '/admin'; // Yönlendirme
            } else {
                return response.json();
            }
        })
        .then(data => {
            if (data.status === 'error') {
                const errors = Object.values(data.errors).flat().join('<br>');
                document.getElementById("error-message").innerHTML = errors;
            }
        })
        .catch(error => {
            console.error('Error during register:', error);
            alert('There was an error while trying to register.');
        });
    });
</script>
</body>

</html>